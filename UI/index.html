<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡å­è®¡ç®—æ§åˆ¶ç³»ç»Ÿ</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 40px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 900px;
            width: 90%;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .card {
            background: linear-gradient(135deg, #5a7eff 0%, #4a6cf7 100%);
            border-radius: 20px;
            padding: 40px 30px;
            text-align: center;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 10px 30px rgba(90, 126, 255, 0.3);
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(90, 126, 255, 0.4);
            background: linear-gradient(135deg, #6b84ff 0%, #5b7dff 100%);
        }

        .card:active {
            transform: translateY(-2px);
        }

        .card-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .card-subtitle {
            font-size: 16px;
            opacity: 0.9;
            font-weight: 300;
        }

        .icon {
            font-size: 48px;
            margin-bottom: 20px;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .container {
                padding: 20px;
                margin: 20px;
            }
            
            .card {
                padding: 30px 20px;
                min-height: 150px;
            }
            
            .card-title {
                font-size: 20px;
            }
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .modal-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }

        .modal-content {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #5a7eff;
            color: white;
        }

        .btn-primary:hover {
            background: #4a6cf7;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        /* å®æ—¶æ•°æ®æ˜¾ç¤ºæ¨¡æ€æ¡†æ ·å¼ */
        .realtime-modal {
            max-width: 800px;
            width: 95%;
            max-height: 90vh;
        }

        .chart-container {
            width: 100%;
            height: 400px;
            margin: 20px 0;
            position: relative;
        }

        .realtime-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .info-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .info-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }

        /* å‚æ•°åº“æ¨¡æ€æ¡†æ ·å¼ */
        .parameters-modal {
            max-width: 600px;
            width: 95%;
        }

        .param-group {
            margin-bottom: 20px;
        }

        .param-label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .param-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .param-input:focus {
            outline: none;
            border-color: #5a7eff;
        }

        .param-description {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }

        .code-output {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }

        .code-header {
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <div class="grid">
                <button class="card" @click="openModal('submit')">
                    <div class="icon">ğŸ“¤</div>
                    <div class="card-title">ä»»åŠ¡æ‰§è¡Œå’Œæäº¤åŒº</div>
                    <div class="card-subtitle">submit</div>
                </button>

                <button class="card" @click="openModal('realtime')">
                    <div class="icon">ğŸ“Š</div>
                    <div class="card-title">å®æ—¶æ•°æ®æ˜¾ç¤º</div>
                    <div class="card-subtitle">Real-time Data</div>
                </button>

                <button class="card" @click="openModal('parameters')">
                    <div class="icon">âš™ï¸</div>
                    <div class="card-title">å‚æ•°åº“</div>
                    <div class="card-subtitle">Parameters</div>
                </button>

                <button class="card" @click="openModal('control')">
                    <div class="icon">ğŸ›ï¸</div>
                    <div class="card-title">æ“ä½œé¢æ¿</div>
                    <div class="card-subtitle">Control Panel</div>
                </button>
            </div>
        </div>

        <!-- æ¨¡æ€æ¡† -->
        <div v-if="showModal" class="modal-overlay" @click="closeModal">
            <!-- å®æ—¶æ•°æ®æ˜¾ç¤ºæ¨¡æ€æ¡† -->
            <div v-if="currentModule === 'realtime'" class="modal realtime-modal" @click.stop>
                <h2 class="modal-title">{{ modalTitle }}</h2>
                <div class="realtime-info">
                    <div class="info-card">
                        <div class="info-label">å½“å‰å€¼</div>
                        <div class="info-value">{{ currentValue.toFixed(3) }}</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">é¢‘ç‡ (Hz)</div>
                        <div class="info-value">{{ sinParams.frequency }}</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">å¹…åº¦</div>
                        <div class="info-value">{{ sinParams.amplitude }}</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">ç›¸ä½ (rad)</div>
                        <div class="info-value">{{ sinParams.phase }}</div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas ref="realtimeChart"></canvas>
                </div>
                <div class="modal-buttons">
                    <button class="btn btn-secondary" @click="closeModal">å…³é—­</button>
                </div>
            </div>

            <!-- å‚æ•°åº“æ¨¡æ€æ¡† -->
            <div v-if="currentModule === 'parameters'" class="modal parameters-modal" @click.stop>
                <h2 class="modal-title">{{ modalTitle }}</h2>
                <div class="modal-content">
                    <div class="param-group">
                        <label class="param-label">é¢‘ç‡ (Hz)</label>
                        <input 
                            type="number" 
                            class="param-input" 
                            v-model.number="tempParams.frequency"
                            step="0.1"
                            min="0.1"
                            max="10"
                        >
                        <div class="param-description">æ§åˆ¶sinå‡½æ•°çš„æŒ¯è¡é¢‘ç‡ï¼ŒèŒƒå›´ï¼š0.1-10 Hz</div>
                    </div>
                    
                    <div class="param-group">
                        <label class="param-label">å¹…åº¦</label>
                        <input 
                            type="number" 
                            class="param-input" 
                            v-model.number="tempParams.amplitude"
                            step="0.1"
                            min="0.1"
                            max="5"
                        >
                        <div class="param-description">æ§åˆ¶sinå‡½æ•°çš„æŒ¯å¹…å¤§å°ï¼ŒèŒƒå›´ï¼š0.1-5</div>
                    </div>
                    
                    <div class="param-group">
                        <label class="param-label">åˆå§‹ç›¸ä½ (å¼§åº¦)</label>
                        <input 
                            type="number" 
                            class="param-input" 
                            v-model.number="tempParams.phase"
                            step="0.1"
                            min="0"
                            max="6.28"
                        >
                        <div class="param-description">æ§åˆ¶sinå‡½æ•°çš„åˆå§‹ç›¸ä½ï¼ŒèŒƒå›´ï¼š0-2Ï€ (6.28) å¼§åº¦</div>
                    </div>

                    <div v-if="generatedCode" class="code-output">
                        <div class="code-header">ç”Ÿæˆçš„Pythonåç«¯ä»£ç ï¼š</div>
                        {{ generatedCode }}
                    </div>
                </div>
                <div class="modal-buttons">
                    <button class="btn btn-primary" @click="updateParameters">åº”ç”¨å‚æ•°</button>
                    <button class="btn btn-primary" @click="generateBackendCode">ç”Ÿæˆåç«¯ä»£ç </button>
                    <button class="btn btn-secondary" @click="closeModal">å–æ¶ˆ</button>
                </div>
            </div>

            <!-- å…¶ä»–æ¨¡æ€æ¡† -->
            <div v-if="currentModule !== 'realtime' && currentModule !== 'parameters'" class="modal" @click.stop>
                <h2 class="modal-title">{{ modalTitle }}</h2>
                <div class="modal-content">
                    <p>{{ modalContent }}</p>
                </div>
                <div class="modal-buttons">
                    <button class="btn btn-primary" @click="handleAction">ç¡®è®¤</button>
                    <button class="btn btn-secondary" @click="closeModal">å–æ¶ˆ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    showModal: false,
                    currentModule: '',
                    modalTitle: '',
                    modalContent: '',
                    // sinå‡½æ•°å‚æ•°
                    sinParams: {
                        frequency: 1.0,
                        amplitude: 1.0,
                        phase: 0.0
                    },
                    // ä¸´æ—¶å‚æ•°ï¼ˆç”¨äºå‚æ•°åº“ç¼–è¾‘ï¼‰
                    tempParams: {
                        frequency: 1.0,
                        amplitude: 1.0,
                        phase: 0.0
                    },
                    // å®æ—¶æ•°æ®
                    currentValue: 0,
                    timeData: [],
                    valueData: [],
                    chart: null,
                    animationId: null,
                    fetchInterval: null,
                    startTime: Date.now(),
                    generatedCode: ''
                }
            },
            methods: {
                openModal(module) {
                    this.currentModule = module;
                    this.showModal = true;
                    switch(module) {
                        case 'submit':
                            this.modalTitle = 'ä»»åŠ¡æ‰§è¡Œå’Œæäº¤åŒº';
                            this.modalContent = 'åœ¨è¿™é‡Œæ‚¨å¯ä»¥æäº¤å’Œæ‰§è¡Œé‡å­è®¡ç®—ä»»åŠ¡ï¼Œç›‘æ§ä»»åŠ¡çŠ¶æ€ï¼ŒæŸ¥çœ‹æ‰§è¡Œç»“æœã€‚';
                            break;
                        case 'realtime':
                            this.modalTitle = 'å®æ—¶æ•°æ®æ˜¾ç¤º';
                            this.modalContent = 'å®æ—¶æ˜¾ç¤ºç³»ç»Ÿè¿è¡ŒçŠ¶æ€ã€ä¼ æ„Ÿå™¨æ•°æ®ã€é‡å­æ¯”ç‰¹çŠ¶æ€ç­‰å…³é”®ä¿¡æ¯ã€‚';
                            this.initRealtimeChart();
                            break;
                        case 'parameters':
                            this.modalTitle = 'å‚æ•°åº“';
                            this.modalContent = 'ç®¡ç†å’Œé…ç½®ç³»ç»Ÿå‚æ•°ï¼ŒåŒ…æ‹¬ç¡¬ä»¶å‚æ•°ã€ç®—æ³•å‚æ•°ã€æ ¡å‡†æ•°æ®ç­‰ã€‚';
                            // æ‹‰å–åç«¯å‚æ•°
                            fetch('http://localhost:5000/api/sin')
                                .then(res => res.json())
                                .then(data => {
                                    this.tempParams = {
                                        frequency: data.frequency,
                                        amplitude: data.amplitude,
                                        phase: data.phase
                                    };
                                });
                            break;
                        case 'control':
                            this.modalTitle = 'æ“ä½œé¢æ¿';
                            this.modalContent = 'ç³»ç»Ÿæ§åˆ¶ä¸­å¿ƒï¼Œå¯ä»¥è¿›è¡Œè®¾å¤‡æ§åˆ¶ã€å‚æ•°è°ƒèŠ‚ã€ç³»ç»Ÿç»´æŠ¤ç­‰æ“ä½œã€‚';
                            break;
                    }
                },
                closeModal() {
                    this.showModal = false;
                    this.currentModule = '';
                    this.generatedCode = '';
                    // åœæ­¢å®æ—¶æ•°æ®æ›´æ–°
                    if (this.fetchInterval) {
                        clearInterval(this.fetchInterval);
                        this.fetchInterval = null;
                    }
                    if (this.animationId) {
                        cancelAnimationFrame(this.animationId);
                        this.animationId = null;
                    }
                    // é”€æ¯å›¾è¡¨
                    if (this.chart) {
                        this.chart.destroy();
                        this.chart = null;
                    }
                },
                initRealtimeChart() {
                    this.$nextTick(() => {
                        const ctx = this.$refs.realtimeChart.getContext('2d');
                        // å¦‚æœå·²æœ‰ chartï¼Œå…ˆé”€æ¯
                        if (this.chart) {
                            this.chart.destroy();
                        }
                        this.chart = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: [],
                                datasets: [{
                                    label: 'Sinå‡½æ•°å®æ—¶æ•°æ®',
                                    data: [],
                                    borderColor: '#5a7eff',
                                    backgroundColor: 'rgba(90, 126, 255, 0.1)',
                                    borderWidth: 2,
                                    fill: true,
                                    tension: 0.4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                animation: {
                                    duration: 0
                                },
                                interaction: {
                                    intersect: false
                                },
                                scales: {
                                    x: {
                                        title: {
                                            display: true,
                                            text: 'æ—¶é—´ (ç§’)'
                                        }
                                    },
                                    y: {
                                        title: {
                                            display: true,
                                            text: 'å¹…å€¼'
                                        }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        display: true
                                    }
                                }
                            },
                            plugins: []
                        });
                        this.startRealtimeUpdate();
                    });
                },
                startRealtimeUpdate() {
                    const maxDataPoints = 500; // å¢åŠ æ•°æ®ç‚¹æ•°é‡ä»¥ä¾¿æ‹–åŠ¨æŸ¥çœ‹æ›´å¤šå†å²æ•°æ®
                    this.startTime = Date.now();
                    // æ¸…ç©ºä¹‹å‰çš„interval
                    if (this.fetchInterval) {
                        clearInterval(this.fetchInterval);
                    }
                    // æ¸…ç©ºå›¾è¡¨æ•°æ®ï¼Œä»æ–°å¼€å§‹
                    this.chart.data.labels = [];
                    this.chart.data.datasets[0].data = [];
                    
                    this.fetchInterval = setInterval(() => {
                        fetch('http://localhost:5000/api/sin')
                            .then(res => {
                                if (!res.ok) {
                                    throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥');
                                }
                                return res.json();
                            })
                            .then(data => {
                                this.currentValue = data.value;
                                this.sinParams.frequency = data.frequency;
                                this.sinParams.amplitude = data.amplitude;
                                this.sinParams.phase = data.phase;
                                // ä½¿ç”¨åç«¯è¿”å›çš„ç›¸å¯¹æ—¶é—´ä½œä¸ºæ—¶é—´è½´
                                const t = data.current_time ? data.current_time.toFixed(2) : '0.00';
                                this.chart.data.labels.push(t);
                                this.chart.data.datasets[0].data.push(data.value);
                                if (this.chart.data.labels.length > maxDataPoints) {
                                    this.chart.data.labels.shift();
                                    this.chart.data.datasets[0].data.shift();
                                }
                                // å¼ºåˆ¶æ›´æ–°å›¾è¡¨
                                this.chart.update();
                                // å¼ºåˆ¶é‡ç»˜
                                this.chart.render();
                            })
                            .catch(error => {
                                console.error('è·å–æ•°æ®å¤±è´¥:', error);
                            });
                    }, 50); // æ¯50msè¯·æ±‚ä¸€æ¬¡ï¼Œæé«˜åˆ·æ–°ç‡
                },
                updateParameters() {
                    // åº”ç”¨ä¸´æ—¶å‚æ•°åˆ°åç«¯
                    fetch('http://localhost:5000/api/sin/params', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(this.tempParams)
                    })
                    .then(res => res.json())
                    .then(data => {
                        this.sinParams = {
                            frequency: data.frequency,
                            amplitude: data.amplitude,
                            phase: data.phase
                        };
                        alert('å‚æ•°å·²æ›´æ–°ï¼');
                        this.closeModal();
                    });
                },
                generateBackendCode() {
                    const { frequency, amplitude, phase } = this.tempParams;
                    
                    this.generatedCode = `#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Sinå‡½æ•°æ•°æ®ç”Ÿæˆå™¨
è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç  - ${new Date().toLocaleString()}
"""

import numpy as np
import time
import json
from datetime import datetime

class SinDataGenerator:
    def __init__(self):
        self.frequency = ${frequency}  # Hz
        self.amplitude = ${amplitude}
        self.phase = ${phase}  # å¼§åº¦
        self.start_time = time.time()
    
    def get_current_value(self):
        """è·å–å½“å‰æ—¶åˆ»çš„sinå‡½æ•°å€¼"""
        current_time = time.time() - self.start_time
        value = self.amplitude * np.sin(2 * np.pi * self.frequency * current_time + self.phase)
        return value
    
    def get_data_point(self):
        """è·å–åŒ…å«æ—¶é—´æˆ³çš„æ•°æ®ç‚¹"""
        timestamp = time.time()
        value = self.get_current_value()
        return {
            'timestamp': timestamp,
            'time_str': datetime.fromtimestamp(timestamp).strftime('%Y-%m-%d %H:%M:%S.%f')[:-3],
            'value': value,
            'parameters': {
                'frequency': self.frequency,
                'amplitude': self.amplitude,
                'phase': self.phase
            }
        }
    
    def update_parameters(self, frequency=None, amplitude=None, phase=None):
        """æ›´æ–°å‚æ•°"""
        if frequency is not None:
            self.frequency = frequency
        if amplitude is not None:
            self.amplitude = amplitude
        if phase is not None:
            self.phase = phase
        
        # é‡ç½®å¼€å§‹æ—¶é—´
        self.start_time = time.time()
    
    def generate_data_stream(self, duration=10, sample_rate=10):
        """ç”ŸæˆæŒ‡å®šæ—¶é•¿çš„æ•°æ®æµ"""
        data_points = []
        total_samples = int(duration * sample_rate)
        
        for i in range(total_samples):
            time.sleep(1.0 / sample_rate)
            data_point = self.get_data_point()
            data_points.append(data_point)
            print(f"Time: {data_point['time_str']}, Value: {data_point['value']:.6f}")
        
        return data_points

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    # åˆ›å»ºç”Ÿæˆå™¨å®ä¾‹
    generator = SinDataGenerator()
    
    print("Sinå‡½æ•°æ•°æ®ç”Ÿæˆå™¨å¯åŠ¨")
    print(f"å‚æ•°è®¾ç½®: é¢‘ç‡={generator.frequency}Hz, å¹…åº¦={generator.amplitude}, ç›¸ä½={generator.phase}rad")
    print("-" * 50)
    
    try:
        # å®æ—¶æ•°æ®ç”Ÿæˆç¤ºä¾‹
        for i in range(50):  # ç”Ÿæˆ50ä¸ªæ•°æ®ç‚¹
            data_point = generator.get_data_point()
            print(f"[{i+1:2d}] {data_point['time_str']} | å€¼: {data_point['value']:8.4f}")
            time.sleep(0.1)  # æ¯100msç”Ÿæˆä¸€ä¸ªæ•°æ®ç‚¹
            
    except KeyboardInterrupt:
        print("\\næ•°æ®ç”Ÿæˆåœæ­¢")
    
    print("\\nç¨‹åºç»“æŸ")`;
                },
                handleAction() {
                    // è¿™é‡Œå¯ä»¥æ·»åŠ å…·ä½“çš„åŠŸèƒ½é€»è¾‘
                    console.log(`æ‰§è¡Œ ${this.currentModule} æ¨¡å—çš„æ“ä½œ`);
                    alert(`æ­£åœ¨å¯åŠ¨ ${this.modalTitle} æ¨¡å—...`);
                    this.closeModal();
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
