<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÈáèÂ≠êËÆ°ÁÆóÊéßÂà∂Á≥ªÁªü</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 40px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 900px;
            width: 90%;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .card {
            background: linear-gradient(135deg, #5a7eff 0%, #4a6cf7 100%);
            border-radius: 20px;
            padding: 40px 30px;
            text-align: center;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 10px 30px rgba(90, 126, 255, 0.3);
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(90, 126, 255, 0.4);
            background: linear-gradient(135deg, #6b84ff 0%, #5b7dff 100%);
        }

        .card:active {
            transform: translateY(-2px);
        }

        .card-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .card-subtitle {
            font-size: 16px;
            opacity: 0.9;
            font-weight: 300;
        }

        .icon {
            font-size: 48px;
            margin-bottom: 20px;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .container {
                padding: 20px;
                margin: 20px;
            }
            
            .card {
                padding: 30px 20px;
                min-height: 150px;
            }
            
            .card-title {
                font-size: 20px;
            }
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .modal-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }

        .modal-content {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #5a7eff;
            color: white;
        }

        .btn-primary:hover {
            background: #4a6cf7;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        /* ÂÆûÊó∂Êï∞ÊçÆÊòæÁ§∫Ê®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .realtime-modal {
            max-width: 800px;
            width: 95%;
            max-height: 90vh;
        }

        .chart-container {
            width: 100%;
            height: 400px;
            margin: 20px 0;
            position: relative;
        }

        .realtime-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .info-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .info-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }

        /* ÂèÇÊï∞Â∫ìÊ®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .parameters-modal {
            max-width: 600px;
            width: 95%;
        }

        .param-group {
            margin-bottom: 20px;
        }

        .param-label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .param-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .param-input:focus {
            outline: none;
            border-color: #5a7eff;
        }

        .param-description {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }

        .code-output {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }

        .code-header {
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <div class="grid">
                <button class="card" @click="openModal('submit')">
                    <div class="icon">üì§</div>
                    <div class="card-title">‰ªªÂä°ÊâßË°åÂíåÊèê‰∫§Âå∫</div>
                    <div class="card-subtitle">submit</div>
                </button>

                <button class="card" @click="openModal('realtime')">
                    <div class="icon">üìä</div>
                    <div class="card-title">ÂÆûÊó∂Êï∞ÊçÆÊòæÁ§∫</div>
                    <div class="card-subtitle">Real-time Data</div>
                </button>

                <button class="card" @click="openModal('parameters')">
                    <div class="icon">‚öôÔ∏è</div>
                    <div class="card-title">ÂèÇÊï∞Â∫ì</div>
                    <div class="card-subtitle">Parameters</div>
                </button>

                <button class="card" @click="openModal('control')">
                    <div class="icon">üéõÔ∏è</div>
                    <div class="card-title">Êìç‰ΩúÈù¢Êùø</div>
                    <div class="card-subtitle">Control Panel</div>
                </button>
            </div>
        </div>

        <!-- Ê®°ÊÄÅÊ°Ü -->
        <div v-if="showModal" class="modal-overlay" @click="closeModal">
            <!-- ÂÆûÊó∂Êï∞ÊçÆÊòæÁ§∫Ê®°ÊÄÅÊ°Ü -->
            <div v-if="currentModule === 'realtime'" class="modal realtime-modal" @click.stop>
                <h2 class="modal-title">{{ modalTitle }}</h2>
                <div class="realtime-info">
                    <div class="info-card">
                        <div class="info-label">ÂΩìÂâçÂÄº</div>
                        <div class="info-value">{{ currentValue.toFixed(3) }}</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">È¢ëÁéá (Hz)</div>
                        <div class="info-value">{{ sinParams.frequency }}</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">ÂπÖÂ∫¶</div>
                        <div class="info-value">{{ sinParams.amplitude }}</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Áõ∏‰Ωç (rad)</div>
                        <div class="info-value">{{ sinParams.phase }}</div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas ref="realtimeChart"></canvas>
                </div>
                <div class="modal-buttons">
                    <button class="btn btn-secondary" @click="closeModal">ÂÖ≥Èó≠</button>
                </div>
            </div>

            <!-- ÂèÇÊï∞Â∫ìÊ®°ÊÄÅÊ°Ü -->
            <div v-if="currentModule === 'parameters'" class="modal parameters-modal" @click.stop>
                <h2 class="modal-title">{{ modalTitle }}</h2>
                <div class="modal-content">
                    <div class="param-group">
                        <label class="param-label">È¢ëÁéá (Hz)</label>
                        <input 
                            type="number" 
                            class="param-input" 
                            v-model.number="tempParams.frequency"
                            step="0.1"
                            min="0.1"
                            max="10"
                        >
                        <div class="param-description">ÊéßÂà∂sinÂáΩÊï∞ÁöÑÊåØËç°È¢ëÁéáÔºåËåÉÂõ¥Ôºö0.1-10 Hz</div>
                    </div>
                    
                    <div class="param-group">
                        <label class="param-label">ÂπÖÂ∫¶</label>
                        <input 
                            type="number" 
                            class="param-input" 
                            v-model.number="tempParams.amplitude"
                            step="0.1"
                            min="0.1"
                            max="5"
                        >
                        <div class="param-description">ÊéßÂà∂sinÂáΩÊï∞ÁöÑÊåØÂπÖÂ§ßÂ∞èÔºåËåÉÂõ¥Ôºö0.1-5</div>
                    </div>
                    
                    <div class="param-group">
                        <label class="param-label">ÂàùÂßãÁõ∏‰Ωç (ÂºßÂ∫¶)</label>
                        <input 
                            type="number" 
                            class="param-input" 
                            v-model.number="tempParams.phase"
                            step="0.1"
                            min="0"
                            max="6.28"
                        >
                        <div class="param-description">ÊéßÂà∂sinÂáΩÊï∞ÁöÑÂàùÂßãÁõ∏‰ΩçÔºåËåÉÂõ¥Ôºö0-2œÄ (6.28) ÂºßÂ∫¶</div>
                    </div>

                    <div v-if="generatedCode" class="code-output">
                        <div class="code-header">ÁîüÊàêÁöÑPythonÂêéÁ´Ø‰ª£Á†ÅÔºö</div>
                        {{ generatedCode }}
                    </div>
                </div>
                <div class="modal-buttons">
                    <button class="btn btn-primary" @click="updateParameters">Â∫îÁî®ÂèÇÊï∞</button>
                    <button class="btn btn-primary" @click="generateBackendCode">ÁîüÊàêÂêéÁ´Ø‰ª£Á†Å</button>
                    <button class="btn btn-secondary" @click="closeModal">ÂèñÊ∂à</button>
                </div>
            </div>

            <!-- ÂÖ∂‰ªñÊ®°ÊÄÅÊ°Ü -->
            <div v-if="currentModule !== 'realtime' && currentModule !== 'parameters'" class="modal" @click.stop>
                <h2 class="modal-title">{{ modalTitle }}</h2>
                <div class="modal-content">
                    <p>{{ modalContent }}</p>
                </div>
                <div class="modal-buttons">
                    <button class="btn btn-primary" @click="handleAction">Á°ÆËÆ§</button>
                    <button class="btn btn-secondary" @click="closeModal">ÂèñÊ∂à</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    showModal: false,
                    currentModule: '',
                    modalTitle: '',
                    modalContent: '',
                    // sinÂáΩÊï∞ÂèÇÊï∞
                    sinParams: {
                        frequency: 1.0,
                        amplitude: 1.0,
                        phase: 0.0
                    },
                    // ‰∏¥Êó∂ÂèÇÊï∞ÔºàÁî®‰∫éÂèÇÊï∞Â∫ìÁºñËæëÔºâ
                    tempParams: {
                        frequency: 1.0,
                        amplitude: 1.0,
                        phase: 0.0
                    },
                    // ÂÆûÊó∂Êï∞ÊçÆ
                    currentValue: 0,
                    timeData: [],
                    valueData: [],
                    chart: null,
                    animationId: null,
                    fetchInterval: null,
                    startTime: Date.now(),
                    generatedCode: ''
                }
            },
            methods: {
                openModal(module) {
                    this.currentModule = module;
                    this.showModal = true;
                    switch(module) {
                        case 'submit':
                            this.modalTitle = '‰ªªÂä°ÊâßË°åÂíåÊèê‰∫§Âå∫';
                            this.modalContent = 'Âú®ËøôÈáåÊÇ®ÂèØ‰ª•Êèê‰∫§ÂíåÊâßË°åÈáèÂ≠êËÆ°ÁÆó‰ªªÂä°ÔºåÁõëÊéß‰ªªÂä°Áä∂ÊÄÅÔºåÊü•ÁúãÊâßË°åÁªìÊûú„ÄÇ';
                            break;
                        case 'realtime':
                            this.modalTitle = 'ÂÆûÊó∂Êï∞ÊçÆÊòæÁ§∫';
                            this.modalContent = 'ÂÆûÊó∂ÊòæÁ§∫Á≥ªÁªüËøêË°åÁä∂ÊÄÅ„ÄÅ‰º†ÊÑüÂô®Êï∞ÊçÆ„ÄÅÈáèÂ≠êÊØîÁâπÁä∂ÊÄÅÁ≠âÂÖ≥ÈîÆ‰ø°ÊÅØ„ÄÇ';
                            this.initRealtimeChart();
                            break;
                        case 'parameters':
                            this.modalTitle = 'ÂèÇÊï∞Â∫ì';
                            this.modalContent = 'ÁÆ°ÁêÜÂíåÈÖçÁΩÆÁ≥ªÁªüÂèÇÊï∞ÔºåÂåÖÊã¨Á°¨‰ª∂ÂèÇÊï∞„ÄÅÁÆóÊ≥ïÂèÇÊï∞„ÄÅÊ†°ÂáÜÊï∞ÊçÆÁ≠â„ÄÇ';
                            // ÊãâÂèñÂêéÁ´ØÂèÇÊï∞
                            fetch('http://localhost:5000/api/sin')
                                .then(res => res.json())
                                .then(data => {
                                    this.tempParams = {
                                        frequency: data.frequency,
                                        amplitude: data.amplitude,
                                        phase: data.phase
                                    };
                                });
                            break;
                        case 'control':
                            this.modalTitle = 'Êìç‰ΩúÈù¢Êùø';
                            this.modalContent = 'Á≥ªÁªüÊéßÂà∂‰∏≠ÂøÉÔºåÂèØ‰ª•ËøõË°åËÆæÂ§áÊéßÂà∂„ÄÅÂèÇÊï∞Ë∞ÉËäÇ„ÄÅÁ≥ªÁªüÁª¥Êä§Á≠âÊìç‰Ωú„ÄÇ';
                            break;
                    }
                },
                closeModal() {
                    this.showModal = false;
                    this.currentModule = '';
                    this.generatedCode = '';
                    // ÂÅúÊ≠¢ÂÆûÊó∂Êï∞ÊçÆÊõ¥Êñ∞
                    if (this.fetchInterval) {
                        clearInterval(this.fetchInterval);
                        this.fetchInterval = null;
                    }
                    if (this.animationId) {
                        cancelAnimationFrame(this.animationId);
                        this.animationId = null;
                    }
                    // ÈîÄÊØÅÂõæË°®
                    if (this.chart) {
                        this.chart.destroy();
                        this.chart = null;
                    }
                },
                initRealtimeChart() {
                    this.$nextTick(() => {
                        const ctx = this.$refs.realtimeChart.getContext('2d');
                        // Â¶ÇÊûúÂ∑≤Êúâ chartÔºåÂÖàÈîÄÊØÅ
                        if (this.chart) {
                            this.chart.destroy();
                        }
                        this.chart = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: [],
                                datasets: [{
                                    label: 'SinÂáΩÊï∞ÂÆûÊó∂Êï∞ÊçÆ',
                                    data: [],
                                    borderColor: '#5a7eff',
                                    backgroundColor: 'rgba(90, 126, 255, 0.1)',
                                    borderWidth: 2,
                                    fill: true,
                                    tension: 0.4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                animation: {
                                    duration: 0
                                },
                                interaction: {
                                    intersect: false
                                },
                                scales: {
                                    x: {
                                        title: {
                                            display: true,
                                            text: 'Êó∂Èó¥ (Áßí)'
                                        }
                                    },
                                    y: {
                                        title: {
                                            display: true,
                                            text: 'ÂπÖÂÄº'
                                        }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        display: true
                                    }
                                }
                            },
                            plugins: []
                        });
                        this.startRealtimeUpdate();
                    });
                },
                startRealtimeUpdate() {
                    const maxDataPoints = 500; // Â¢ûÂä†Êï∞ÊçÆÁÇπÊï∞Èáè‰ª•‰æøÊãñÂä®Êü•ÁúãÊõ¥Â§öÂéÜÂè≤Êï∞ÊçÆ
                    this.startTime = Date.now();
                    // Ê∏ÖÁ©∫‰πãÂâçÁöÑinterval
                    if (this.fetchInterval) {
                        clearInterval(this.fetchInterval);
                    }
                    // Ê∏ÖÁ©∫ÂõæË°®Êï∞ÊçÆÔºå‰ªéÊñ∞ÂºÄÂßã
                    this.chart.data.labels = [];
                    this.chart.data.datasets[0].data = [];
                    
                    this.fetchInterval = setInterval(() => {
                        fetch('http://localhost:5000/api/sin')
                            .then(res => {
                                if (!res.ok) {
                                    throw new Error('ÁΩëÁªúËØ∑Ê±ÇÂ§±Ë¥•');
                                }
                                return res.json();
                            })
                            .then(data => {
                                this.currentValue = data.value;
                                this.sinParams.frequency = data.frequency;
                                this.sinParams.amplitude = data.amplitude;
                                this.sinParams.phase = data.phase;
                                // ‰ΩøÁî®ÂêéÁ´ØËøîÂõûÁöÑÁõ∏ÂØπÊó∂Èó¥‰Ωú‰∏∫Êó∂Èó¥ËΩ¥
                                const t = data.current_time ? data.current_time.toFixed(2) : '0.00';
                                this.chart.data.labels.push(t);
                                this.chart.data.datasets[0].data.push(data.value);
                                if (this.chart.data.labels.length > maxDataPoints) {
                                    this.chart.data.labels.shift();
                                    this.chart.data.datasets[0].data.shift();
                                }
                                // Âº∫Âà∂Êõ¥Êñ∞ÂõæË°®
                                this.chart.update();
                                // Âº∫Âà∂ÈáçÁªò
                                this.chart.render();
                            })
                            .catch(error => {
                                console.error('Ëé∑ÂèñÊï∞ÊçÆÂ§±Ë¥•:', error);
                            });
                    }, 50); // ÊØè50msËØ∑Ê±Ç‰∏ÄÊ¨°ÔºåÊèêÈ´òÂà∑Êñ∞Áéá
                },
                updateParameters() {
                    // Â∫îÁî®‰∏¥Êó∂ÂèÇÊï∞Âà∞ÂêéÁ´Ø
                    fetch('http://localhost:5000/api/sin/params', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(this.tempParams)
                    })
                    .then(res => res.json())
                    .then(data => {
                        this.sinParams = {
                            frequency: data.frequency,
                            amplitude: data.amplitude,
                            phase: data.phase
                        };
                        alert('ÂèÇÊï∞Â∑≤Êõ¥Êñ∞ÔºÅ');
                        this.closeModal();
                    });
                },
                generateBackendCode() {
                    const { frequency, amplitude, phase } = this.tempParams;
                    
                    this.generatedCode = `#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
SinÂáΩÊï∞Êï∞ÊçÆÁîüÊàêÂô®
Ëá™Âä®ÁîüÊàêÁöÑ‰ª£Á†Å - ${new Date().toLocaleString()}
"""

import numpy as np
import time
import json
from datetime import datetime

class SinDataGenerator:
    def __init__(self):
        self.frequency = ${frequency}  # Hz
        self.amplitude = ${amplitude}
        self.phase = ${phase}  # ÂºßÂ∫¶
        self.start_time = time.time()
    
    def get_current_value(self):
        """Ëé∑ÂèñÂΩìÂâçÊó∂ÂàªÁöÑsinÂáΩÊï∞ÂÄº"""
        current_time = time.time() - self.start_time
        value = self.amplitude * np.sin(2 * np.pi * self.frequency * current_time + self.phase)
        return value
    
    def get_data_point(self):
        """Ëé∑ÂèñÂåÖÂê´Êó∂Èó¥Êà≥ÁöÑÊï∞ÊçÆÁÇπ"""
        timestamp = time.time()
        value = self.get_current_value()
        return {
            'timestamp': timestamp,
            'time_str': datetime.fromtimestamp(timestamp).strftime('%Y-%m-%d %H:%M:%S.%f')[:-3],
            'value': value,
            'parameters': {
                'frequency': self.frequency,
                'amplitude': self.amplitude,
                'phase': self.phase
            }
        }
    
    def update_parameters(self, frequency=None, amplitude=None, phase=None):
        """Êõ¥Êñ∞ÂèÇÊï∞"""
        if frequency is not None:
            self.frequency = frequency
        if amplitude is not None:
            self.amplitude = amplitude
        if phase is not None:
            self.phase = phase
        
        # ÈáçÁΩÆÂºÄÂßãÊó∂Èó¥
        self.start_time = time.time()
    
    def generate_data_stream(self, duration=10, sample_rate=10):
        """ÁîüÊàêÊåáÂÆöÊó∂ÈïøÁöÑÊï∞ÊçÆÊµÅ"""
        data_points = []
        total_samples = int(duration * sample_rate)
        
        for i in range(total_samples):
            time.sleep(1.0 / sample_rate)
            data_point = self.get_data_point()
            data_points.append(data_point)
            print(f"Time: {data_point['time_str']}, Value: {data_point['value']:.6f}")
        
        return data_points

# ‰ΩøÁî®Á§∫‰æã
if __name__ == "__main__":
    # ÂàõÂª∫ÁîüÊàêÂô®ÂÆû‰æã
    generator = SinDataGenerator()
    
    print("SinÂáΩÊï∞Êï∞ÊçÆÁîüÊàêÂô®ÂêØÂä®")
    print(f"ÂèÇÊï∞ËÆæÁΩÆ: È¢ëÁéá={generator.frequency}Hz, ÂπÖÂ∫¶={generator.amplitude}, Áõ∏‰Ωç={generator.phase}rad")
    print("-" * 50)
    
    try:
        # ÂÆûÊó∂Êï∞ÊçÆÁîüÊàêÁ§∫‰æã
        for i in range(50):  # ÁîüÊàê50‰∏™Êï∞ÊçÆÁÇπ
            data_point = generator.get_data_point()
            print(f"[{i+1:2d}] {data_point['time_str']} | ÂÄº: {data_point['value']:8.4f}")
            time.sleep(0.1)  # ÊØè100msÁîüÊàê‰∏Ä‰∏™Êï∞ÊçÆÁÇπ
            
    except KeyboardInterrupt:
        print("\\nÊï∞ÊçÆÁîüÊàêÂÅúÊ≠¢")
    
    print("\\nÁ®ãÂ∫èÁªìÊùü")`;
                },
                handleAction() {
                    // ËøôÈáåÂèØ‰ª•Ê∑ªÂä†ÂÖ∑‰ΩìÁöÑÂäüËÉΩÈÄªËæë
                    console.log(`ÊâßË°å ${this.currentModule} Ê®°ÂùóÁöÑÊìç‰Ωú`);
                    alert(`Ê≠£Âú®ÂêØÂä® ${this.modalTitle} Ê®°Âùó...`);
                    this.closeModal();
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
